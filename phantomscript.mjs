import{curry,filter,join,length,map,pipe,split}from'f-utility';import commander from'commander';import fs from'fs';import F from'fluture';var alterRange=function(a){return 1&a-8206},characterEdge=function(a){return String.fromCharCode(57073*a+8206)},charCodeAt=function(a){return a.charCodeAt()},CONTROL_REGEX=/[^\x00-\x7F]/g,hexCharCode=function(a){return'\\u{'+a.charCodeAt().toString(16)+'}'},EMPTY='',stringWrap=curry(function(a,b,c){return pipe(split(a),map(b),join(a))(c)}),mapWrap=stringWrap(EMPTY),controlSplit=function(a){return CONTROL_REGEX.test(a)?mapWrap(hexCharCode,a):a},convertToAscii=function(a){return pipe(Array.from,map(controlSplit),join(EMPTY))(a)},magicRange=function(a){return 8206===a||65279===a},match=function(a){return a.match(/.{8}/g)},ninthBit=function(a){return(256|a.charCodeAt()).toString(2).slice(1)},parseBinaryCharCode=function(a){return String.fromCharCode(parseInt(a,2))},fun=Object.freeze({alterRange:alterRange,characterEdge:characterEdge,charCodeAt:charCodeAt,controlSplit:controlSplit,convertToAscii:convertToAscii,hexCharCode:hexCharCode,magicRange:magicRange,mapWrap:mapWrap,match:match,ninthBit:ninthBit,parseBinaryCharCode:parseBinaryCharCode,stringWrap:stringWrap}),K=Object.freeze({EMPTY:EMPTY,CONTROL_REGEX:CONTROL_REGEX}),encode=pipe(convertToAscii,mapWrap(ninthBit),mapWrap(characterEdge)),joinNothing=join(EMPTY),decode=pipe(Array.from,map(charCodeAt),filter(magicRange),map(alterRange),joinNothing,match,map(parseBinaryCharCode),joinNothing),test=pipe(Array.from,map(charCodeAt),filter(magicRange),length,function(a){if(0<a)throw new Error('Found zero-width characters!');return!1}),cmd=function(){return commander.description('convert javascript to zero-width characters and vice-versa').option('-e, --encode','convert to phantomscript').option('-d, --decode','convert from phantomscript (-e flag takes precedence)').option('-o, --output [file]','write to file').option('--stdin','read from stdin').parse(process.argv)},writeFile=curry(function(a,b,c){return new F(function(d,f){fs.writeFile(a,c,b,function(a,b){return a?void d(a):void f(b)})})}),log=function(a){return a&&process.stdout.write(a)},processor=curry(function(a,b){var c=b.encode;void 0===c&&(c=!0);var d=b.decode;void 0===d&&(d=!1);var e=b.args,f=b.output,g=b.stdin;void 0===g&&(g=!1);var h=encode;c&&(h=encode),d&&(h=decode);var i=function(a){if(!a)throw new Error('Unable to convert null input');var b=f?writeFile(f,'utf8'):F.of,c=h(a);b(c).fork(log,log)};return g||0===e.length?void a.fork(log,i):void i(e[0])}),exe=function(a){return pipe(cmd,processor(a))},fn=fun,constants=K;export{fn,constants,encode,decode,test,exe,processor};
